## Bugs in sales formset
# Summary of the bugs I found (priority order)

1. **Newly added rows do not get the warehouse product list immediately.**  
    You append the `empty_form` HTML, but you never populate that new `.product-select` with the products for the currently selected warehouse. The `loadProductsForWarehouse()` function updates `.product-select` elements only when the warehouse is changed (or when AJAX returns). So after clicking “Add Another Item” the product select is empty until the user toggles the warehouse.
    
2. **Deleted/hidden rows can still affect totals.**  
    When the user clicks the remove button on an existing form (which sets the `-DELETE` checkbox and hides the row), `updateGrandTotal()` still iterates the hidden row and adds its total because the row's inputs still exist in DOM (just hidden). This makes the grand total wrong.
    
3. **After adding a new row you don’t trigger events needed to set price/total.**  
    The new product select and inputs need either a `change`/`input` trigger or `loadProductsForWarehouse()` call so that the product selection sets the price and totals. You also should recalc totals after append.
    
4. **(Fragile) Using `empty_form.as_p|escapejs` may produce markup that lacks expected wrapper classes/hidden fields arrangement.**  
    `empty_form.as_p` will render `<p>` wrappers and possibly different markup than the per-form rendering in your template. That often works, but it can be brittle — consider rendering an explicit `empty_form` template block to ensure classes and hidden fields line up exactly with the existing rows. (See suggestions below.)


